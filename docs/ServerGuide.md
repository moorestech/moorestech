# サーバーガイド

`moorestech_server` はゲームロジックを担当する Unity プロジェクトです。ここではサーバー側の構成と基本的な起動方法をまとめます。

## プロジェクトの場所

```
moorestech_server/
├── Assets
├── Packages
└── ProjectSettings
```

## 起動手順

1. Unity Hub から `moorestech_server` プロジェクトを開きます。
2. `Boot` シーンをロードし、Play ボタンを押してサーバーを起動します。

## アーキテクチャ概要

サーバーは階層構造を持ち、主に以下のレイヤーで構成されています。

```
Server.Boot → Server.Protocol → Game.World → Game.Block / Game.Entity / Game.PlayerInventory → Core
```

- **Server.Boot**: DI コンテナの構築やマップ・MOD の読み込みを行うエントリーポイント。
- **Server.Protocol**: クライアントとの通信を管理します。MessagePack でデータを送受信します。
- **Game.World**: ブロック配置やエンティティを管理するワールド全体の制御レイヤー。
- **Core**: アイテムやインベントリ、マスターデータといった基盤機能を提供します。

### 詳細レイヤー構成

全体像を図で表すと次のようになります。

```
+---------------------------------------------------------------+
|                         Server.Boot                           |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                        Server.Protocol                        |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                          Game.World                           |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  Game.Block  |  Game.Entity  |  Game.PlayerInventory  | ...   |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|    Core.Item    |    Core.Inventory    |    Core.Master    |  |
+---------------------------------------------------------------+
```

各レイヤーの役割を簡潔にまとめると次のとおりです。

- **Server.Boot**: 依存性注入の設定、マップやMODの読み込み、サーバーの初期化を行います。
- **Server.Protocol**: クライアントとの接続管理やパケット送受信を担います。
- **Game.World**: ブロック配置、エンティティ管理、ワールド全体の状態を保持します。
- **Game.Block / Game.Entity**: 各ブロックやエンティティの振る舞いを実装します。
- **Game.PlayerInventory**: プレイヤーが所持するアイテムの管理を行います。
- **Core**: アイテム定義やインベントリ基盤、マスターデータ管理など共通機能を提供します。

## 主なディレクトリ

- `Assets/Server` 以下にゲームロジックのスクリプトが配置されています。
- `Assets/AddressableResources` にはサーバー側で使用するリソースデータが格納されています。

詳しい実装方針は `memory-bank/systemPatterns.md` も参照してください。
