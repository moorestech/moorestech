TrainUnit 手動シナリオ確認リスト

1. 起動と接続
- Unity で moorestech_server を開き、Boot シーンを再生
- Unity で moorestech_client を開き、MainGame シーンを再生して接続

2. ループ構築 (駅2 + 橋脚2)
- 駅1 -> 橋脚1 -> 駅2 -> 橋脚2 -> 駅1 の順に配置
- Rail 接続モードで隣接ノードを順に接続

3. 列車配置
- クライアントでレール上をマウスで指し、プレビューが出た状態で左クリック
- クライアントは RailPositionSnapshot を送信し、サーバーが検証して生成後 `va:event:trainUnitCreated` をブロードキャスト
- ブロードキャストを受けたクライアントの TrainUnitClientCache / Entity が即時更新されることを確認
- 分岐をまたぐ配置では最小 nodeId の入力辺が選ばれることを確認
- 失敗時はレスポンスの FailureType がログに出ることを確認

4. サーバー側ダイアグラム設定
- エントリ: 駅1と駅2の Exit ノード (同一向きで統一)
- 待機条件: WaitForTicks=60 (1秒)
- AutoRun=ON、CurrentIndex=駅1

5. クライアント挙動確認
- 駅到着で停止し、1秒後に出発する (Docked 中は速度0)
- 非駅到着では停止せず、次エントリへ進む
- [TrainDiagramHashVerifier] / [TrainUnitHashVerifier] の警告が出ない

6. StationRef 同期確認
- 駅ブロック配置後に StationRef が反映され、駅扱いになる
- 一時的に非駅扱いになっても最終的に復帰する

7. 列車削除確認 (空スナップショット反映)
- サーバー側で TrainUnit を削除
- クライアント側の列車が消える (ゴースト列車が残らない)
- その後のスナップショット適用で 0 件が維持される

8. cars 未送信の安全性 (任意)
- cars が空/未送信のケースを作れる場合、クラッシュせず動作が続く
