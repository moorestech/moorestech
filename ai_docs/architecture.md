# moorestechプロジェクト アーキテクチャ

このドキュメントでは、moorestechプロジェクトのアーキテクチャについて詳細に説明します。

## 目次

1. [全体アーキテクチャ](#全体アーキテクチャ)
2. [サーバーアーキテクチャ](#サーバーアーキテクチャ)
3. [クライアントアーキテクチャ](#クライアントアーキテクチャ)
4. [通信アーキテクチャ](#通信アーキテクチャ)
5. [ゲームシステムアーキテクチャ](#ゲームシステムアーキテクチャ)

## 全体アーキテクチャ

moorestechは、クライアント・サーバーアーキテクチャを採用しています。サーバーがゲームロジックを処理し、クライアントがユーザーインターフェースとプレイヤー操作を担当します。

```
+-------------------+        +-------------------+
|                   |        |                   |
|  moorestech_client|<------>|  moorestech_server|
|  (Unity)          |  TCP   |  (Unity)          |
|                   |        |                   |
+-------------------+        +-------------------+
```

## サーバーアーキテクチャ

サーバーは、以下のような階層構造を持っています：

```
+---------------------------------------------------------------+
|                         Server.Boot                           |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                        Server.Protocol                        |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                          Game.World                           |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  Game.Block  |  Game.Entity  |  Game.PlayerInventory  | ...   |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|    Core.Item    |    Core.Inventory    |    Core.Master    |  |
+---------------------------------------------------------------+
```

### 主要コンポーネント

- **Server.Boot**: サーバーの起動処理を担当します。DIコンテナの設定、マップのロード、MODのロードなどを行います。
- **Server.Protocol**: クライアントとの通信プロトコルを担当します。パケットの送受信、シリアライズ/デシリアライズなどを行います。
- **Game.World**: ゲームワールド全体を管理します。ブロックの配置、エンティティの管理などを行います。
- **Game.Block**: ブロック関連の機能を提供します。ブロックの種類、状態、コンポーネントなどを管理します。
- **Game.Entity**: エンティティ関連の機能を提供します。エンティティの種類、状態、動作などを管理します。
- **Game.PlayerInventory**: プレイヤーインベントリ関連の機能を提供します。インベントリの管理、アイテムの操作などを行います。
- **Core.Item**: アイテム関連の基本機能を提供します。アイテムの種類、スタック、メタデータなどを管理します。
- **Core.Inventory**: インベントリ関連の基本機能を提供します。アイテムの保存、取得、操作などを行います。
- **Core.Master**: マスターデータ関連の機能を提供します。アイテム、ブロック、レシピなどのマスターデータを管理します。

## クライアントアーキテクチャ

クライアントは、以下のような階層構造を持っています：

```
+---------------------------------------------------------------+
|                       Client.Starter                          |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                       Client.Network                          |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                         Client.Game                           |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  Client.Game.InGame.Block  |  Client.Game.InGame.UI  |  ...   |
+---------------------------------------------------------------+
```

### 主要コンポーネント

- **Client.Starter**: クライアントの起動処理を担当します。DIコンテナの設定、シーンのロード、初期化などを行います。
- **Client.Network**: サーバーとの通信を担当します。パケットの送受信、シリアライズ/デシリアライズなどを行います。
- **Client.Game**: ゲーム全体を管理します。ゲームの状態、シーケンス、イベントなどを管理します。
- **Client.Game.InGame.Block**: ブロック関連のUI機能を提供します。ブロックの表示、操作などを行います。
- **Client.Game.InGame.UI**: UI関連の機能を提供します。インベントリUI、メニューUI、ステータスUIなどを管理します。

## 通信アーキテクチャ

クライアントとサーバー間の通信は、以下のような流れで行われます：

```
+-------------------+                      +-------------------+
|                   |                      |                   |
|  Client           |                      |  Server           |
|                   |                      |                   |
|  +-------------+  |  1. リクエスト送信   |  +-------------+  |
|  |             |  |--------------------->|  |             |  |
|  | VanillaApi  |  |                      |  | PacketHandle|  |
|  |             |  |  2. レスポンス返信   |  |             |  |
|  +-------------+  |<---------------------|  +-------------+  |
|        |          |                      |        |          |
|        v          |                      |        v          |
|  +-------------+  |                      |  +-------------+  |
|  | PacketSender|  |                      |  | PacketRespo|  |
|  +-------------+  |                      |  | nseCreator |  |
|        |          |                      |  +-------------+  |
|        v          |                      |                   |
|  +-------------+  |                      |                   |
|  | ServerCommu |  |                      |                   |
|  | nicator     |  |                      |                   |
|  +-------------+  |                      |                   |
|                   |                      |                   |
+-------------------+                      +-------------------+
```

### 主要コンポーネント

- **VanillaApi**: クライアント側のAPI呼び出しを提供します。サーバーへのリクエスト送信、レスポンス処理などを行います。
- **PacketSender**: パケットの送信を担当します。パケットのシリアライズ、送信などを行います。
- **ServerCommunicator**: サーバーとの通信を担当します。ソケット接続、パケットの送受信などを行います。
- **PacketHandle**: サーバー側のパケット処理を担当します。パケットの受信、デシリアライズ、処理などを行います。
- **PacketResponseCreator**: レスポンスパケットの作成を担当します。レスポンスのシリアライズ、送信などを行います。

## ゲームシステムアーキテクチャ

ゲームシステムは、以下のような主要コンポーネントで構成されています：

```
+---------------------------------------------------------------+
|                         Game.World                            |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                         Game.Block                            |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  IBlock  |  IBlockComponent  |  BlockComponentManager  |  ... |
+---------------------------------------------------------------+
```

### ブロックシステム

ブロックシステムは、以下のようなコンポーネント構造を持っています：

```
+---------------------------------------------------------------+
|                           IBlock                              |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                    BlockComponentManager                      |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  IBlockInventory  |  IBlockConnector  |  IUpdatableBlock  |   |
+---------------------------------------------------------------+
```

- **IBlock**: ブロックのインターフェースを定義します。ブロックID、位置、状態などの基本情報を提供します。
- **BlockComponentManager**: ブロックのコンポーネントを管理します。コンポーネントの追加、取得、削除などを行います。
- **IBlockInventory**: ブロックのインベントリを管理するコンポーネントです。アイテムの保存、取得、操作などを行います。
- **IBlockConnector**: ブロックの接続を管理するコンポーネントです。他のブロックとの接続、切断などを行います。
- **IUpdatableBlock**: 更新可能なブロックを表すコンポーネントです。ブロックの状態更新、処理などを行います。

### アイテムシステム

アイテムシステムは、以下のようなコンポーネント構造を持っています：

```
+---------------------------------------------------------------+
|                          IItemStack                           |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  ItemId  |  Count  |  ItemInstanceId  |  ItemStackMetaData  | |
+---------------------------------------------------------------+
```

- **IItemStack**: アイテムスタックのインターフェースを定義します。アイテムID、数量、インスタンスIDなどの基本情報を提供します。
- **ItemId**: アイテムのIDを表します。アイテムの種類を識別するために使用されます。
- **Count**: アイテムの数量を表します。スタック可能なアイテムの場合、複数のアイテムを1つのスタックにまとめることができます。
- **ItemInstanceId**: アイテムのインスタンスIDを表します。同じ種類のアイテムでも、個別に識別するために使用されます。
- **ItemStackMetaData**: アイテムスタックのメタデータを表します。アイテムの追加情報を保存するために使用されます。

### インベントリシステム

インベントリシステムは、以下のようなコンポーネント構造を持っています：

```
+---------------------------------------------------------------+
|                       IOpenableInventory                      |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  InventoryItems  |  GetItem  |  SetItem  |  InsertItem  |  ...|
+---------------------------------------------------------------+
```

- **IOpenableInventory**: 開けるインベントリのインターフェースを定義します。インベントリの基本操作を提供します。
- **InventoryItems**: インベントリ内のアイテムのリストを表します。インベントリに保存されているアイテムを管理します。
- **GetItem**: 指定スロットのアイテムを取得するメソッドです。インベントリからアイテムを取得するために使用されます。
- **SetItem**: 指定スロットにアイテムを設定するメソッドです。インベントリにアイテムを設定するために使用されます。
- **InsertItem**: アイテムをインベントリに挿入するメソッドです。インベントリにアイテムを追加するために使用されます。

### チャレンジシステム

チャレンジシステムは、以下のようなコンポーネント構造を持っています：

```
+---------------------------------------------------------------+
|                       ChallengeDatastore                      |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|                        IChallengeTask                         |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  BlockPlaceChallenge  |  CreateItemChallenge  |  ...          |
+---------------------------------------------------------------+
```

- **ChallengeDatastore**: チャレンジデータを管理します。チャレンジの作成、完了、保存などを行います。
- **IChallengeTask**: チャレンジタスクのインターフェースを定義します。チャレンジの基本情報と操作を提供します。
- **BlockPlaceChallenge**: ブロック設置チャレンジを表します。特定のブロックを設置するチャレンジを管理します。
- **CreateItemChallenge**: アイテム作成チャレンジを表します。特定のアイテムを作成するチャレンジを管理します。

### アンロックシステム

アンロックシステムは、以下のようなコンポーネント構造を持っています：

```
+---------------------------------------------------------------+
|                 IGameUnlockStateDataController                |
+---------------------------------------------------------------+
                               |
                               v
+---------------------------------------------------------------+
|  CraftRecipeUnlockStateInfo  |  ItemUnlockStateInfo  |  ...   |
+---------------------------------------------------------------+
```

- **IGameUnlockStateDataController**: ゲームアンロック状態データコントローラーのインターフェースを定義します。アンロック状態の管理、操作を提供します。
- **CraftRecipeUnlockStateInfo**: クラフトレシピのアンロック状態情報を表します。クラフトレシピのアンロック状態を管理します。
- **ItemUnlockStateInfo**: アイテムのアンロック状態情報を表します。アイテムのアンロック状態を管理します。

以上がmoorestechプロジェクトのアーキテクチャの概要です。詳細については、各モジュールのコードやコメントを参照してください。