# 要件定義書

## はじめに
歯車発電機は、機械的な回転エネルギー（トルクとRPM）を電気エネルギーに変換するブロックです。このブロックは、風車や水車、蒸気エンジンなどの動力源から得られる回転力を電力に変換します。エネルギー充足率と発電量が線形の関係を持つため、入力エネルギーに対する発電量が予測しやすく、プレイヤーが直感的に理解できる発電システムを提供します。

## 要件

### 要件1: 基本的な動力変換機能
**目的:** プレイヤーとして、歯車の回転エネルギーを電力に変換したいので、持続可能な電力供給を実現できる

#### 受け入れ基準
1. WHEN 歯車発電機が有効な歯車ネットワークに接続されている THEN 歯車発電機 SHALL 入力されたRPMとトルクを取得する
2. WHEN 歯車発電機が電力ネットワークに接続されている THEN 歯車発電機 SHALL 計算された電力を電力ネットワークに供給する
3. IF 入力RPMが0 THEN 歯車発電機 SHALL 発電量を0とする
4. IF 入力トルクが0 THEN 歯車発電機 SHALL 発電量を0とする
5. WHILE 歯車発電機が正常に動作している THE 歯車発電機 SHALL 毎フレーム発電量を更新する

### 要件2: エネルギー充足率による線形発電制御
**目的:** プレイヤーとして、入力エネルギーと発電量の関係を予測可能にしたいので、線形な変換特性を持つ発電機を使用できる

#### 受け入れ基準
1. WHERE エネルギー充足率を計算する際 THE 歯車発電機 SHALL 式「充足率 = (実際のRPM/要求RPM) × (実際のトルク/要求トルク)」を使用する
2. WHEN エネルギー充足率が100%である THEN 歯車発電機 SHALL 最大発電量を出力する
3. WHEN エネルギー充足率が50%である THEN 歯車発電機 SHALL 最大発電量の50%を出力する
4. WHERE 発電量を計算する際 THE 歯車発電機 SHALL 式「発電量 = 最大発電量 × エネルギー充足率」を使用する（線形関係）
5. IF エネルギー充足率が100%を超える THEN 歯車発電機 SHALL 発電量を最大発電量に制限する（クリッピング）

### 要件3: パラメータ設定機能
**目的:** プレイヤーとして、発電機の性能パラメータを確認し調整したいので、最適な運転条件を設定できる

#### 受け入れ基準
1. WHEN プレイヤーが歯車発電機のGUIを開く THEN 歯車発電機 SHALL 現在の発電量、エネルギー充足率、入力RPM、入力トルクを表示する
2. IF 設定が有効化されている THEN 歯車発電機 SHALL 要求RPMと要求トルクの調整を許可する
3. WHEN プレイヤーが要求値を変更する THEN 歯車発電機 SHALL 新しい要求値に基づいてエネルギー充足率を再計算する
4. WHERE GUIにエネルギー充足率を表示する際 THE 歯車発電機 SHALL 充足率をパーセンテージ形式で表示する

### 要件4: ネットワーク接続仕様
**目的:** プレイヤーとして、歯車発電機を既存のインフラに統合したいので、適切に接続できる

#### 受け入れ基準
1. WHEN 歯車発電機の背面に歯車または歯車機械が配置される THEN 歯車発電機 SHALL 歯車ネットワークからの動力入力を受け付ける
2. WHEN 歯車発電機の前面に電柱または電力機械が配置される THEN 歯車発電機 SHALL 電力ネットワークへの電力出力を行う
3. IF 複数の歯車が接続されている THEN 歯車発電機 SHALL 最も高いRPMの入力を使用する
4. WHILE 歯車ネットワークに接続されている THE 歯車発電機 SHALL 発電量に応じた負荷トルクをネットワークにフィードバックする

### 要件5: 発電量計算仕様
**目的:** プレイヤーとして、予測可能で理解しやすい発電量を得たいので、計算ロジックを理解できる

#### 受け入れ基準
1. WHERE 最大発電量を定義する際 THE 歯車発電機 SHALL 要求RPMと要求トルクでの動作時に100 ElectricPowerを出力するよう設定する
2. WHEN エネルギー充足率が100%である THEN 歯車発電機 SHALL 100 ElectricPowerを発電する
3. WHERE 実際の発電量を計算する際 THE 歯車発電機 SHALL 式「発電量 = 100 × エネルギー充足率」を使用する
4. IF 入力RPMまたは入力トルクが要求値の200%を超える THEN 歯車発電機 SHALL 警告を表示し、充足率を100%に制限する
